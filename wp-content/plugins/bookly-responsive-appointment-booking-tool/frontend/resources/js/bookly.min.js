!function(W){"use strict";W=W&&W.hasOwnProperty("default")?W.default:W;var G={};function V(e){var o=Ladda.create(e);return o.start(),o}function ee(e){var o=e.offset().top,t=W(window).scrollTop();(o<W(window).scrollTop()||o>t+window.innerHeight)&&W("html,body").animate({scrollTop:o-24},500)}function oe(e){var o=W.extend({action:"bookly_render_complete",csrf_token:BooklyL10n.csrf_token},e),t=G[e.form_id].$container;W.ajax({url:BooklyL10n.ajaxurl,data:o,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){e.success&&(e.final_step_url&&!o.error?document.location.href=e.final_step_url:(t.html(e.html),ee(t)))}})}function te(l){var d=G[l.form_id].$container;W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:{action:"bookly_render_payment",csrf_token:BooklyL10n.csrf_token,form_id:l.form_id,page_url:document.URL.split("#")[0]},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){if(e.success){if(e.disabled)return void c(l.form_id);d.html(e.html),ee(d),"cancelled"==G[l.form_id].status.booking&&(G[l.form_id].status.booking="ok");var o=W(".bookly-payment",d),t=W(".bookly-js-apply-coupon",d),a=W("input.bookly-user-coupon",d),s=W(".bookly-js-coupon-error",d),i=W("input[type=radio][name=bookly-full-payment]",d),r=W(".bookly-info-text-coupon",d),n=W(".bookly-gateway-buttons,form.bookly-authorize_net,form.bookly-stripe",d);o.on("click",function(){n.hide(),W(".bookly-gateway-buttons.pay-"+W(this).val(),d).show(),"card"==W(this).val()&&W("form.bookly-"+W(this).data("form"),d).show()}),o.eq(0).trigger("click"),i.on("change",function(){var e={action:"bookly_deposit_payments_apply_payment_method",csrf_token:BooklyL10n.csrf_token,form_id:l.form_id,deposit_full:W(this).val()};W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:e,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){e.success&&te({form_id:l.form_id})}})}),t.on("click",function(e){var o=V(this);s.text(""),a.removeClass("bookly-error");var t={action:"bookly_coupons_apply_coupon",csrf_token:BooklyL10n.csrf_token,form_id:l.form_id,coupon_code:a.val()};W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:t,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){e.success?te({form_id:l.form_id}):(s.html(G[l.form_id].errors[e.error]),a.addClass("bookly-error"),r.html(e.text),ee(s),o.stop())},error:function(){o.stop()}})}),W(".bookly-js-next-step",d).on("click",function(e){var t,a=V(this);if(W(".bookly-payment[value=local]",d).is(":checked")||W(this).hasClass("bookly-js-coupon-payment"))e.preventDefault(),c(l.form_id);else if(W(".bookly-payment[value=card]",d).is(":checked")){var o=W(".bookly-payment[data-form=stripe]",d).is(":checked"),s=o?"bookly_stripe_payment":"bookly_authorize_net_aim_payment";t=d.find(o?".bookly-stripe":".bookly-authorize_net"),e.preventDefault();var i={action:s,csrf_token:BooklyL10n.csrf_token,card:{number:t.find('input[name="card_number"]').val(),cvc:t.find('input[name="card_cvc"]').val(),exp_month:t.find('select[name="card_exp_month"]').val(),exp_year:t.find('select[name="card_exp_year"]').val()},form_id:l.form_id},r=function(e){W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:e,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){e.success?oe({form_id:l.form_id}):"cart_item_not_available"==e.error?f(e,l.form_id):"payment_error"==e.error&&(a.stop(),t.find(".bookly-js-card-error").text(e.error_message))}})};if(o&&t.find("#publishable_key").val())try{Stripe.setPublishableKey(t.find("#publishable_key").val()),Stripe.createToken(i.card,function(e,o){o.error?(t.find(".bookly-js-card-error").text(o.error.message),a.stop()):(i.card=o.id,r(i))})}catch(e){t.find(".bookly-js-card-error").text(e.message),a.stop()}else r(i)}else(W(".bookly-payment[value=paypal]",d).is(":checked")||W(".bookly-payment[value=2checkout]",d).is(":checked")||W(".bookly-payment[value=payu_biz]",d).is(":checked")||W(".bookly-payment[value=payu_latam]",d).is(":checked")||W(".bookly-payment[value=payson]",d).is(":checked")||W(".bookly-payment[value=mollie]",d).is(":checked"))&&(e.preventDefault(),0<(t=W(this).closest("form")).find("input.bookly-payment-id").length?W.ajax({type:"POST",url:BooklyL10n.ajaxurl,xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,data:{action:"bookly_pro_save_pending_appointment",csrf_token:BooklyL10n.csrf_token,form_id:l.form_id,payment_type:t.data("gateway")},dataType:"json",success:function(e){e.success?(t.find("input.bookly-payment-id").val(e.payment_id),t.submit()):"cart_item_not_available"==e.error&&f(e,l.form_id)}}):W.ajax({type:"POST",url:BooklyL10n.ajaxurl,xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,data:{action:"bookly_check_cart",csrf_token:BooklyL10n.csrf_token,form_id:l.form_id},dataType:"json",success:function(e){e.success?t.submit():"cart_item_not_available"==e.error&&f(e,l.form_id)}}))}),W(".bookly-js-back-step",d).on("click",function(e){e.preventDefault(),V(this),D({form_id:l.form_id})})}}})}function c(o){W.ajax({type:"POST",url:BooklyL10n.ajaxurl,xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,data:{action:"bookly_save_appointment",csrf_token:BooklyL10n.csrf_token,form_id:o},dataType:"json"}).done(function(e){e.success?oe({form_id:o}):"cart_item_not_available"==e.error&&f(e,o)})}function f(e,o){G[o].skip_steps.cart?ie({form_id:o},G[o].errors[e.error]):ae({form_id:o},{failed_key:e.failed_cart_key,message:G[o].errors[e.error]})}function D(K){var e=W.extend({action:"bookly_render_details",csrf_token:BooklyL10n.csrf_token},K),Q=G[K.form_id].$container;W.ajax({url:BooklyL10n.ajaxurl,data:e,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){if(e.success){Q.html(e.html),ee(Q);var l=e.intlTelInput,d=e.update_details_dialog,c=e.woocommerce;G[K.form_id].hasOwnProperty("google_maps")&&G[K.form_id].google_maps.enabled&&(Q||W(".bookly-form .bookly-details-step")).each(function(){!function(t){var e=t.find(".bookly-js-cst-address-autocomplete");if(e.length){var i=new google.maps.places.Autocomplete(e[0],{types:["geocode"]}),o=[{selector:".bookly-js-address-country",val:function(){return a("country")},short:function(){return a("country",!0)}},{selector:".bookly-js-address-postcode",val:function(){return a("postal_code")}},{selector:".bookly-js-address-city",val:function(){return a("locality")}},{selector:".bookly-js-address-state",val:function(){return a("administrative_area_level_1")},short:function(){return a("administrative_area_level_1",!0)}},{selector:".bookly-js-address-street",val:function(){return a("route")}},{selector:".bookly-js-address-street_number",val:function(){return a("street_number")}}],a=function(e,o){for(var t=i.getPlace().address_components,a=0;a<t.length;a++){var s=t[a].types[0];if(s===e)return o?t[a].short_name:t[a].long_name}return""};i.addListener("place_changed",function(){o.forEach(function(e){var o=t.find(e.selector);0!==o.length&&(o.val(e.val()),"function"==typeof e.short&&o.data("short",e.short()))})})}}(W(this))}),W(document.body).trigger("bookly.render.step_detail",[Q]);var f="",t=W(".bookly-js-guest",Q),m=W(".bookly-js-user-phone-input",Q),y=W(".bookly-js-user-email",Q),u=W(".bookly-js-select-birthday-day",Q),k=W(".bookly-js-select-birthday-month",Q),p=W(".bookly-js-select-birthday-year",Q),_=W(".bookly-js-address-country",Q),h=W(".bookly-js-address-state",Q),b=W(".bookly-js-address-postcode",Q),v=W(".bookly-js-address-city",Q),j=W(".bookly-js-address-street",Q),g=W(".bookly-js-address-street_number",Q),w=W(".bookly-js-address-additional_address",Q),x=W(".bookly-js-address-country-error",Q),C=W(".bookly-js-address-state-error",Q),L=W(".bookly-js-address-postcode-error",Q),B=W(".bookly-js-address-city-error",Q),T=W(".bookly-js-address-street-error",Q),D=W(".bookly-js-address-street_number-error",Q),S=W(".bookly-js-address-additional_address-error",Q),O=W(".bookly-js-select-birthday-day-error",Q),M=W(".bookly-js-select-birthday-month-error",Q),q=W(".bookly-js-select-birthday-year-error",Q),F=W(".bookly-js-full-name",Q),P=W(".bookly-js-first-name",Q),E=W(".bookly-js-last-name",Q),R=W(".bookly-js-user-notes",Q),o=W(".bookly-custom-field",Q),a=W(".bookly-js-info-field",Q),H=W(".bookly-js-user-phone-error",Q),X=W(".bookly-js-user-email-error",Q),I=W(".bookly-js-full-name-error",Q),z=W(".bookly-js-first-name-error",Q),N=W(".bookly-js-last-name-error",Q),s=W(".bookly-js-captcha-img",Q),i=W(".bookly-custom-field-error",Q),r=W(".bookly-js-info-field-error",Q),n=W(".bookly-js-modal",Q),Y=W(".bookly-js-login",Q),Z=W(".bookly-js-cst-duplicate",Q),J=W(".bookly-js-next-step",Q),$=W([O,M,q,x,C,L,B,T,D,S,I,z,N,H,X,i,r]).map(W.fn.toArray),A=W([u,k,p,v,_,b,h,j,g,w,F,P,E,m,y,o,a]).map(W.fn.toArray),U=function(e){if(F.val(e.data.full_name).removeClass("bookly-error"),P.val(e.data.first_name).removeClass("bookly-error"),E.val(e.data.last_name).removeClass("bookly-error"),e.data.birthday){var o=e.data.birthday.split("-"),t=parseInt(o[0]),a=parseInt(o[1]),s=parseInt(o[2]);u.val(s).removeClass("bookly-error"),k.val(a).removeClass("bookly-error"),p.val(t).removeClass("bookly-error")}e.data.phone&&(m.removeClass("bookly-error"),l.enabled?m.intlTelInput("setNumber",e.data.phone):m.val(e.data.phone)),e.data.country&&_.val(e.data.country).removeClass("bookly-error"),e.data.state&&h.val(e.data.state).removeClass("bookly-error"),e.data.postcode&&b.val(e.data.postcode).removeClass("bookly-error"),e.data.city&&v.val(e.data.city).removeClass("bookly-error"),e.data.street&&j.val(e.data.street).removeClass("bookly-error"),e.data.street_number&&g.val(e.data.street_number).removeClass("bookly-error"),e.data.additional_address&&w.val(e.data.additional_address).removeClass("bookly-error"),y.val(e.data.email).removeClass("bookly-error"),e.data.info_fields&&e.data.info_fields.forEach(function(e){var o=Q.find('.bookly-js-info-field-row[data-id="'+e.id+'"]');switch(o.data("type")){case"checkboxes":e.value.forEach(function(e){o.find(".bookly-js-info-field").filter(function(){return this.value==e}).prop("checked",!0)});break;case"radio-buttons":o.find(".bookly-js-info-field").filter(function(){return this.value==e.value}).prop("checked",!0);break;default:o.find(".bookly-js-info-field").val(e.value)}}),$.filter(":not(.bookly-custom-field-error)").html("")};l.enabled&&m.intlTelInput({preferredCountries:[l.country],initialCountry:l.country,geoIpLookup:function(t){W.get("https://ipinfo.io",function(){},"jsonp").always(function(e){var o=e&&e.country?e.country:"";t(o)})},utilsScript:l.utils}),W("body > .bookly-js-modal."+K.form_id).remove(),n.addClass(K.form_id).appendTo("body").on("click",".bookly-js-close",function(e){e.preventDefault(),W(e.delegateTarget).removeClass("bookly-in").find("form").trigger("reset").end().find("input").removeClass("bookly-error").end().find(".bookly-label-error").html("")}),W(".bookly-js-login-show",Q).on("click",function(e){e.preventDefault(),Y.addClass("bookly-in")}),W("button:submit",Y).on("click",function(e){e.preventDefault();var o=Ladda.create(this);o.start(),W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:{action:"bookly_wp_user_login",csrf_token:BooklyL10n.csrf_token,form_id:K.form_id,log:Y.find('[name="log"]').val(),pwd:Y.find('[name="pwd"]').val(),rememberme:Y.find('[name="rememberme"]').prop("checked")?1:0},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){e.success?(BooklyL10n.csrf_token=e.data.csrf_token,t.fadeOut("slow"),U(e),Y.removeClass("bookly-in")):"incorrect_username_password"==e.error&&(Y.find("input").addClass("bookly-error"),Y.find(".bookly-label-error").html(G[K.form_id].errors[e.error])),o.stop()}})}),W("button:submit",Z).on("click",function(e){e.preventDefault(),Z.removeClass("bookly-in"),J.trigger("click",[1])}),G[K.form_id].hasOwnProperty("facebook")&&G[K.form_id].facebook.enabled&&(FB.XFBML.parse(W(".bookly-js-fb-login-button",Q).parent().get(0)),G[K.form_id].facebook.onStatusChange=function(e){"connected"===e.status&&(G[K.form_id].facebook.enabled=!1,G[K.form_id].facebook.onStatusChange=void 0,t.fadeOut("slow",function(){W(".bookly-js-fb-login-button").hide()}),FB.api("/me",{fields:"id,name,first_name,last_name,email"},function(e){W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:W.extend(e,{action:"bookly_pro_facebook_login",csrf_token:BooklyL10n.csrf_token,form_id:K.form_id}),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){e.success&&U(e)}})}))}),J.on("click",function(e,o){e.preventDefault();var a,t=[],s={},i=[],r=V(this);W("div.bookly-js-info-field-row",Q).each(function(){var e=W(this);switch(e.data("type")){case"text-field":t.push({id:e.data("id"),value:e.find("input.bookly-js-info-field").val()});break;case"textarea":t.push({id:e.data("id"),value:e.find("textarea.bookly-js-info-field").val()});break;case"checkboxes":a=[],e.find("input.bookly-js-info-field:checked").each(function(){a.push(this.value)}),t.push({id:e.data("id"),value:a});break;case"radio-buttons":t.push({id:e.data("id"),value:e.find("input.bookly-js-info-field:checked").val()||null});break;case"drop-down":t.push({id:e.data("id"),value:e.find("select.bookly-js-info-field").val()})}}),W(".bookly-custom-fields-container",Q).each(function(){var e=W(this),o=e.data("key"),t=[];W("div.bookly-custom-field-row",e).each(function(){var e=W(this);switch(e.data("type")){case"text-field":case"file":t.push({id:e.data("id"),value:e.find("input.bookly-custom-field").val()});break;case"textarea":t.push({id:e.data("id"),value:e.find("textarea.bookly-custom-field").val()});break;case"checkboxes":a=[],e.find("input.bookly-custom-field:checked").each(function(){a.push(this.value)}),t.push({id:e.data("id"),value:a});break;case"radio-buttons":t.push({id:e.data("id"),value:e.find("input.bookly-custom-field:checked").val()||null});break;case"drop-down":t.push({id:e.data("id"),value:e.find("select.bookly-custom-field").val()});break;case"captcha":t.push({id:e.data("id"),value:e.find("input.bookly-custom-field").val()}),i.push(e.data("id"))}}),s[o]={custom_fields:JSON.stringify(t)}});try{""==(f=l.enabled?m.intlTelInput("getNumber"):m.val())&&(f=m.val())}catch(e){f=m.val()}var n={action:"bookly_session_save",csrf_token:BooklyL10n.csrf_token,form_id:K.form_id,full_name:F.val(),first_name:P.val(),last_name:E.val(),phone:f,email:y.val(),birthday:{day:u.val(),month:k.val(),year:p.val()},country:_.val(),state:h.val(),postcode:b.val(),city:v.val(),street:j.val(),street_number:g.val(),additional_address:w.val(),address_iso:{country:_.data("short"),state:h.data("short")},info_fields:t,notes:R.val(),cart:s,captcha_ids:JSON.stringify(i),force_update_customer:!d||o};W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:n,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(o){if($.empty(),A.removeClass("bookly-error"),o.success)if(c.enabled){var e={action:"bookly_pro_add_to_woocommerce_cart",csrf_token:BooklyL10n.csrf_token,form_id:K.form_id};W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:e,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){e.success?window.location.href=c.cart_url:(r.stop(),ie({form_id:K.form_id},G[K.form_id].errors[e.error]))}})}else te({form_id:K.form_id});else{var i=null;if(o.appointments_limit_reached)oe({form_id:K.form_id,error:"appointments_limit_reached"});else{r.stop();[{name:"full_name",errorElement:I,formElement:F},{name:"first_name",errorElement:z,formElement:P},{name:"last_name",errorElement:N,formElement:E},{name:"phone",errorElement:H,formElement:m},{name:"email",errorElement:X,formElement:y},{name:"birthday_day",errorElement:O,formElement:u},{name:"birthday_month",errorElement:M,formElement:k},{name:"birthday_year",errorElement:q,formElement:p},{name:"country",errorElement:x,formElement:_},{name:"state",errorElement:C,formElement:h},{name:"postcode",errorElement:L,formElement:b},{name:"city",errorElement:B,formElement:v},{name:"street",errorElement:T,formElement:j},{name:"street_number",errorElement:D,formElement:g},{name:"additional_address",errorElement:S,formElement:w}].forEach(function(e){o[e.name]&&(e.errorElement.html(o[e.name]),e.formElement.addClass("bookly-error"),null===i&&(i=e.formElement))}),o.info_fields&&W.each(o.info_fields,function(e,o){var t=W('div.bookly-js-info-field-row[data-id="'+e+'"]',Q);t.find(".bookly-js-info-field-error").html(o),t.find(".bookly-js-info-field").addClass("bookly-error"),null===i&&(i=t.find(".bookly-js-info-field"))}),o.custom_fields&&W.each(o.custom_fields,function(s,e){W.each(e,function(e,o){var t=W('.bookly-custom-fields-container[data-key="'+s+'"]',Q),a=W('[data-id="'+e+'"]',t);a.find(".bookly-custom-field-error").html(o),a.find(".bookly-custom-field").addClass("bookly-error"),null===i&&(i=a.find(".bookly-custom-field"))})}),o.customer&&Z.find(".bookly-js-modal-body").html(o.customer).end().addClass("bookly-in")}null!==i&&ee(i)}}})}),W(".bookly-js-back-step",Q).on("click",function(e){e.preventDefault(),V(this),G[K.form_id].skip_steps.cart?G[K.form_id].skip_steps.repeat?ie({form_id:K.form_id}):se({form_id:K.form_id}):ae({form_id:K.form_id})}),W(".bookly-js-captcha-refresh",Q).on("click",function(){s.css("opacity","0.5"),W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:{action:"bookly_custom_fields_captcha_refresh",form_id:K.form_id,csrf_token:BooklyL10n.csrf_token},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){e.success&&s.attr("src",e.data.captcha_url).on("load",function(){s.css("opacity","1")})}})})}}})}function ae(o,t){if(G[o.form_id].skip_steps.cart)D(o);else{o&&o.from_step&&(G[o.form_id].cart_prev_step=o.from_step);var e=W.extend({action:"bookly_render_cart",csrf_token:BooklyL10n.csrf_token},o),s=G[o.form_id].$container;W.ajax({url:BooklyL10n.ajaxurl,data:e,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){e.success&&(s.html(e.html),t?(W(".bookly-label-error",s).html(t.message),W('tr[data-cart-key="'+t.failed_key+'"]',s).addClass("bookly-label-error")):W(".bookly-label-error",s).hide(),ee(s),W(".bookly-js-next-step",s).on("click",function(){V(this),D({form_id:o.form_id})}),W(".bookly-add-item",s).on("click",function(){V(this),S({form_id:o.form_id,new_chain:!0})}),W(".bookly-js-back-step",s).on("click",function(e){switch(e.preventDefault(),V(this),G[o.form_id].cart_prev_step){case"service":S({form_id:o.form_id});break;case"extras":P({form_id:o.form_id});break;case"time":ie({form_id:o.form_id});break;case"repeat":se({form_id:o.form_id});break;default:S({form_id:o.form_id})}}),W(".bookly-js-actions button",s).on("click",function(){V(this);var e=W(this),a=e.closest("tr");switch(e.data("action")){case"drop":W.ajax({url:BooklyL10n.ajaxurl,data:{action:"bookly_cart_drop_item",csrf_token:BooklyL10n.csrf_token,form_id:o.form_id,cart_key:a.data("cart-key")},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){if(e.success){var o=a.data("cart-key"),t=W('tr[data-cart-key="'+o+'"]',s);a.delay(300).fadeOut(200,function(){e.data.total_waiting_list?(W(".bookly-js-waiting-list-price",s).html(e.data.waiting_list_price),W(".bookly-js-waiting-list-deposit",s).html(e.data.waiting_list_deposit)):W(".bookly-js-waiting-list-price",s).closest("tr").remove(),W(".bookly-js-subtotal-price",s).html(e.data.subtotal_price),W(".bookly-js-subtotal-deposit",s).html(e.data.subtotal_deposit),W(".bookly-js-pay-now-deposit",s).html(e.data.pay_now_deposit),W(".bookly-js-pay-now-tax",s).html(e.data.pay_now_tax),W(".bookly-js-total-price",s).html(e.data.total_price),W(".bookly-js-total-tax",s).html(e.data.total_tax),t.remove(),0==W("tr[data-cart-key]").length&&(W(".bookly-js-back-step",s).hide(),W(".bookly-js-next-step",s).hide())})}}});break;case"edit":S({form_id:o.form_id,edit_cart_item:a.data("cart-key")})}}))}})}}function se(M,e){if(G[M.form_id].skip_steps.repeat)ae(M,e);else{var o=W.extend({action:"bookly_render_repeat",csrf_token:BooklyL10n.csrf_token},M),q=G[M.form_id].$container;W.ajax({url:BooklyL10n.ajaxurl,data:o,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){if(e.success){q.html(e.html),ee(q);var o=W(".bookly-js-repeat-appointment-enabled",q),f=W(".bookly-js-next-step",q),t=W(".bookly-js-repeat-variants-container",q),a=W('[class^="bookly-js-variant"]',t),s=W(".bookly-js-repeat-variant",t),i=W(".bookly-js-get-schedule",t),r=W(".bookly-js-variant-weekly",t),n=W(".bookly-js-repeat-variant-monthly",t),l=W(".bookly-js-repeat-until",t),d=W(".bookly-js-repeat-times",t),c=W(".bookly-js-monthly-specific-day",t),m=W(".bookly-js-monthly-week-day",t),y=W(".bookly-js-repeat-daily-every",t),u=W(".bookly-js-week-day",t),k=W(".bookly-js-schedule-container",q),p=W(".bookly-js-days-error",t),_=W(".bookly-js-schedule-slots",k),h=W(".bookly-js-intersection-info",k),b=W(".bookly-js-schedule-help",k),v=W(".bookly-well",k),j=W(".bookly-pagination",k),g=W(".bookly-schedule-row-template .bookly-schedule-row",k),w=e.pages_warning_info,x=e.short_date_format,C={min:e.date_min||!0,max:e.date_max||!0},L=[],B={prepareButtonNextState:function(){for(var e=f.prop("disabled"),o=0==L.length,t=0;t<L.length;t++)if(e){if(!L[t].deleted){o=!1;break}}else{if(!L[t].deleted){o=!1;break}o=!0}f.prop("disabled",o)},addTimeSlotControl:function(e,o,a,s){var i,r="";o.length&&(r=W("<select/>"),W.each(o,function(e,o){var t=W("<option/>");t.text(o.title).val(o.value),o.disabled&&t.attr("disabled","disabled"),r.append(t),i||o.disabled||(o.title==a?(r.val(o.value),i=!0):o.title==s&&r.val(o.value))}));e.find(".bookly-js-schedule-time").html(r),e.find("div.bookly-label-error").toggle(!o.length)},renderSchedulePage:function(e){var o,t=L.length,a=5*e-5,s=[];_.html("");for(var i=a,r=0;r<5&&i<t;i++,r++)(o=g.clone()).data("datetime",L[i].datetime),o.data("index",L[i].index),W("> div:first-child",o).html(L[i].index),W(".bookly-schedule-date",o).html(L[i].display_date),void 0!==L[i].all_day_service_time?(W(".bookly-js-schedule-time",o).hide(),W(".bookly-js-schedule-all-day-time",o).html(L[i].all_day_service_time).show()):(W(".bookly-js-schedule-time",o).html(L[i].display_time).show(),W(".bookly-js-schedule-all-day-time",o).hide()),L[i].another_time&&W(".bookly-schedule-intersect",o).show(),L[i].deleted&&o.find(".bookly-schedule-appointment").addClass("bookly-appointment-hidden"),_.append(o);if(5<t){var n=W("<li/>").html("«");for(n.on("click",function(){var e=parseInt(j.find(".active").html());1<e&&B.renderSchedulePage(e-1)}),j.html(n),i=0,r=1;i<t;i+=5,r++)n=W("<li/>").html(r),j.append(n),n.on("click",function(){B.renderSchedulePage(W(this).html())});for(j.find("li:eq("+e+")").addClass("active"),(n=W("<li/>").html("»")).on("click",function(){var e=parseInt(j.find(".active").html());e<t/5&&B.renderSchedulePage(e+1)}),j.append(n).show(),i=0;i<t;i++)L[i].another_time&&(e=parseInt(i/5)+1,s.push(e),i=5*e-1);0<s.length&&h.html(w.replace("{list}",s.join(", "))),v.toggle(0<s.length),j.toggle(5<t)}else for(j.hide(),v.hide(),i=0;i<t;i++)if(L[i].another_time){b.show();break}},renderFullSchedule:function(e){L=e;var c=null;W.each(L,function(e,o){c||o.another_time||(c=o.display_time)}),B.renderSchedulePage(1),k.show(),f.prop("disabled",0==L.length),_.on("click","button[data-action]",function(){var o=W(this).closest(".bookly-schedule-row"),a=o.data("index")-1;switch(W(this).data("action")){case"drop":L[a].deleted=!0,o.find(".bookly-schedule-appointment").addClass("bookly-appointment-hidden"),B.prepareButtonNextState();break;case"restore":L[a].deleted=!1,o.find(".bookly-schedule-appointment").removeClass("bookly-appointment-hidden"),f.prop("disabled",!1);break;case"edit":var e=W('<input type="text"/>'),s=W(this),i=V(this);o.find(".bookly-schedule-date").html(e),e.pickadate({min:C.min,max:C.max,formatSubmit:"yyyy-mm-dd",format:x,clear:!1,close:!1,today:BooklyL10n.today,monthsFull:BooklyL10n.months,weekdaysFull:BooklyL10n.days,weekdaysShort:BooklyL10n.daysShort,labelMonthNext:BooklyL10n.nextMonth,labelMonthPrev:BooklyL10n.prevMonth,firstDay:G[M.form_id].start_of_week,onSet:function(){var t=[];W.each(L,function(e,o){a==e||o.deleted||t.push(o.slots)}),W.ajax({url:BooklyL10n.ajaxurl,type:"POST",data:{action:"bookly_recurring_appointments_get_daily_customer_schedule",csrf_token:BooklyL10n.csrf_token,date:this.get("select","yyyy-mm-dd"),form_id:M.form_id,exclude:t},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){s.hide(),i.stop(),e.data.length?(B.addTimeSlotControl(o,e.data[0].options,c,L[a].display_time,e.data[0].all_day_service_time),o.find('button[data-action="save"]').show()):(B.addTimeSlotControl(o,[]),o.find('button[data-action="save"]').hide())}})}});var t=JSON.parse(L[a].slots);e.pickadate("picker").set("select",new Date(t[0][2]));break;case"save":W(this).hide(),o.find('button[data-action="edit"]').show();var r=o.find(".bookly-schedule-date"),n=o.find(".bookly-js-schedule-time"),l=n.find("select"),d=l.find("option:selected");L[a].slots=l.val(),L[a].display_date=r.find("input").val(),L[a].display_time=d.text(),r.html(L[a].display_date),n.html(L[a].display_time)}})},isDateMatchesSelections:function(e){switch(s.val()){case"daily":if((6<y.val()||-1!=W.inArray(e.format("ddd").toLowerCase(),B.week_days))&&e.diff(B.date_from,"days")%y.val()==0)return!0;break;case"weekly":case"biweekly":if(("weekly"==s.val()||e.diff(B.date_from.clone().startOf("isoWeek"),"weeks")%2==0)&&-1!=W.inArray(e.format("ddd").toLowerCase(),B.checked_week_days))return!0;break;case"monthly":switch(n.val()){case"specific":if(e.format("D")==c.val())return!0;break;case"last":if(e.format("ddd").toLowerCase()==m.val()&&e.clone().endOf("month").diff(e,"days")<7)return!0;break;default:var o=e.diff(e.clone().startOf("month"),"days");if(e.format("ddd").toLowerCase()==m.val()&&o>=7*(n.prop("selectedIndex")-1)&&o<7*n.prop("selectedIndex"))return!0}}return!1},updateRepeatDate:function(){var e=0,o=d.val(),t=C.min.slice(),a=l.pickadate("picker").get("select"),s=moment().year(a.year).month(a.month).date(a.date).add(5,"years");t[1]++,B.date_from=moment(t.join(","),"YYYY,M,D"),B.week_days=[],m.find("option").each(function(){B.week_days.push(W(this).val())}),B.checked_week_days=[],u.each(function(){W(this).prop("checked")&&B.checked_week_days.push(W(this).val())});for(var i=B.date_from.clone();B.isDateMatchesSelections(i)&&e++,i.add(1,"days"),e<o&&i.isBefore(s););l.val(i.subtract(1,"days").format("MMMM D, YYYY")),l.pickadate("picker").set("select",new Date(i.format("YYYY"),i.format("M")-1,i.format("D")))},updateRepeatTimes:function(){var e=0,o=C.min.slice(),t=l.pickadate("picker").get("select"),a=moment().year(t.year).month(t.month).date(t.date);o[1]++,B.date_from=moment(o.join(","),"YYYY,M,D"),B.week_days=[],m.find("option").each(function(){B.week_days.push(W(this).val())}),B.checked_week_days=[],u.each(function(){W(this).prop("checked")&&B.checked_week_days.push(W(this).val())});for(var s=B.date_from.clone();B.isDateMatchesSelections(s)&&e++,s.add(1,"days"),s.isBefore(a););d.val(e)}};l.pickadate({formatSubmit:"yyyy-mm-dd",format:G[M.form_id].date_format,min:C.min,max:C.max,clear:!1,close:!1,today:BooklyL10n.today,monthsFull:BooklyL10n.months,weekdaysFull:BooklyL10n.days,weekdaysShort:BooklyL10n.daysShort,labelMonthNext:BooklyL10n.nextMonth,labelMonthPrev:BooklyL10n.prevMonth,firstDay:G[M.form_id].start_of_week});var T=o.on("change",function(){t.toggle(W(this).prop("checked")),W(this).prop("checked")?B.prepareButtonNextState():f.prop("disabled",!1)});if(e.repeated){var D=e.repeat_data,S=D.params;o.prop("checked",!0),s.val(D.repeat);var O=D.until.split("-");switch(l.pickadate("set").set("select",new Date(O[0],O[1]-1,O[2])),D.repeat){case"daily":y.val(S.every);break;case"weekly":case"biweekly":W(".bookly-js-week-days input.bookly-js-week-day",t).prop("checked",!1).parent().removeClass("active"),S.on.forEach(function(e){W(".bookly-js-week-days input.bookly-js-week-day[value="+e+"]",t).prop("checked",!0).parent().addClass("active")});break;case"monthly":"day"===S.on?(n.val("specific"),W(".bookly-js-monthly-specific-day[value="+S.day+"]",t).prop("checked",!0)):(n.val(S.on),m.val(S.weekday))}B.renderFullSchedule(e.schedule)}T.trigger("change"),e.could_be_repeated||o.attr("disabled",!0),s.on("change",function(){a.hide(),t.find(".bookly-js-variant-"+this.value).show(),B.updateRepeatTimes()}).trigger("change"),n.on("change",function(){m.toggle("specific"!=this.value),c.toggle("specific"==this.value),B.updateRepeatTimes()}).trigger("change"),u.on("change",function(){var e=W(this);e.is(":checked")?e.parent().not("[class*='active']").addClass("active"):e.parent().removeClass("active"),B.updateRepeatTimes()}),c.val(e.date_min[2]),c.on("change",function(){B.updateRepeatTimes()}),m.on("change",function(){B.updateRepeatTimes()}),l.on("change",function(){B.updateRepeatTimes()}),y.on("change",function(){B.updateRepeatTimes()}),d.on("change",function(){B.updateRepeatDate()}),i.on("click",function(){k.hide();var e={action:"bookly_recurring_appointments_get_customer_schedule",csrf_token:BooklyL10n.csrf_token,form_id:M.form_id,repeat:s.val(),until:l.pickadate("picker").get("select","yyyy-mm-dd"),params:{}},o=V(this);switch(e.repeat){case"daily":e.params={every:y.val()};break;case"weekly":case"biweekly":if(e.params.on=[],W(".bookly-js-week-days input.bookly-js-week-day:checked",r).each(function(){e.params.on.push(this.value)}),0==e.params.on.length)return p.toggle(!0),o.stop(),!1;p.toggle(!1);break;case"monthly":"specific"==n.val()?e.params={on:"day",day:c.val()}:e.params={on:n.val(),weekday:m.val()}}_.off("click"),W.ajax({url:BooklyL10n.ajaxurl,type:"POST",data:e,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){e.success&&(B.renderFullSchedule(e.data),o.stop())}})}),W(".bookly-js-back-step",q).on("click",function(e){e.preventDefault(),V(this),W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:{action:"bookly_session_save",csrf_token:BooklyL10n.csrf_token,form_id:M.form_id,unrepeat:1},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){ie({form_id:M.form_id})}})}),W(".bookly-js-go-to-cart",q).on("click",function(e){e.preventDefault(),V(this),ae({form_id:M.form_id,from_step:"repeat"})}),W(".bookly-js-next-step",q).on("click",function(e){if(V(this),o.is(":checked")){var t=[],a=0;L.forEach(function(e){if(!e.deleted){var o=JSON.parse(e.slots);t=t.concat(o),a++}}),W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:{action:"bookly_session_save",csrf_token:BooklyL10n.csrf_token,form_id:M.form_id,slots:JSON.stringify(t),repeat:a},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){ae({form_id:M.form_id,add_to_cart:!0,from_step:"repeat"})}})}else W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:{action:"bookly_session_save",csrf_token:BooklyL10n.csrf_token,form_id:M.form_id,unrepeat:1},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){ae({form_id:M.form_id,add_to_cart:!0,from_step:"repeat"})}})})}}})}}var o=null;function ie(C,L){null!=o&&(o.abort(),o=null);var e={action:"bookly_render_time",csrf_token:BooklyL10n.csrf_token},B=G[C.form_id].$container;function T(e,s){var o={};return W.each(e,function(t,e){var a='<button class="bookly-day" value="'+t+'">'+e.title+"</button>";W.each(e.slots,function(e,o){a+='<button value="'+JSON.stringify(o.data).replace(/"/g,"&quot;")+'" data-group="'+t+'" class="bookly-hour'+("waiting-list"==o.status?" bookly-slot-in-waiting-list":"booked"==o.status?" booked":"")+'"'+("booked"==o.status?" disabled":"")+'><span class="ladda-label bookly-time-main'+(o.data[0][2]==s?" bookly-bold":"")+'"><i class="bookly-hour-icon"><span></span></i>'+o.time_text+'</span><span class="bookly-time-additional'+("waiting-list"==o.status?" bookly-waiting-list":"")+'"> '+o.additional_text+"</span></button>"}),o[t]=a}),o}G[C.form_id].skip_steps.service&&G[C.form_id].use_client_time_zone&&(e.time_zone=G[C.form_id].timeZone,e.time_zone_offset=G[C.form_id].timeZoneOffset),W.extend(e,C),o=W.ajax({url:BooklyL10n.ajaxurl,data:e,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){if(0!=e.success){BooklyL10n.csrf_token=e.csrf_token,B.html(e.html);var f,m,y,u=W(".bookly-columnizer-wrap",B),k=W(".bookly-columnizer",u),i=W(".bookly-time-next",B),a=W(".bookly-time-prev",B),p=null,_=e.time_slots_wide?205:127,h=e.time_slots_wide?"bookly-column bookly-column-wide":"bookly-column",b=0,r=0,v=e.has_more_slots,j=!1,o=e.show_calendar,n=e.is_rtl,g=e.day_one_column,t=T(e.slots_data,e.selected_date);if(W(".bookly-js-back-step",B).on("click",function(e){e.preventDefault(),V(this),G[C.form_id].skip_steps.extras||G[C.form_id].no_extras?S({form_id:C.form_id}):P({form_id:C.form_id})}).toggle(!G[C.form_id].skip_steps.service||!G[C.form_id].skip_steps.extras),W(".bookly-js-go-to-cart",B).on("click",function(e){e.preventDefault(),V(this),ae({form_id:C.form_id,from_step:"time"})}),W(".bookly-js-time-zone-switcher",B).on("change",function(e){G[C.form_id].timeZone=this.value,G[C.form_id].timeZoneOffset=void 0,w(),ie({form_id:C.form_id,time_zone:G[C.form_id].timeZone})}),o){var s=W(".bookly-js-selected-date",B);s.pickadate({formatSubmit:"yyyy-mm-dd",format:G[C.form_id].date_format,min:e.date_min||!0,max:e.date_max||!0,weekdaysFull:BooklyL10n.days,weekdaysShort:BooklyL10n.daysShort,monthsFull:BooklyL10n.months,firstDay:G[C.form_id].start_of_week,clear:!1,close:!1,today:!1,disable:e.disabled_days,closeOnSelect:!1,klass:{picker:"picker picker--opened picker--focused"},onSet:function(e){if(e.select){var o=this.get("select","yyyy-mm-dd");t[o]?(k.html(t[o]).css("left","0px"),r=b=0,p=null,x(),a.hide(),i.toggle(1!=f.length)):(ie({form_id:C.form_id,selected_date:o}),w())}this.open()},onClose:function(){this.open(!1)},onRender:function(){var e=new Date(Date.UTC(this.get("view").year,this.get("view").month));W(".picker__nav--next").on("click",function(){e.setUTCMonth(e.getUTCMonth()+1),ie({form_id:C.form_id,selected_date:e.toJSON().substr(0,10)}),w()}),W(".picker__nav--prev").on("click",function(){e.setUTCMonth(e.getUTCMonth()-1),ie({form_id:C.form_id,selected_date:e.toJSON().substr(0,10)}),w()})}});var l=s.pickadate("picker").get("select","yyyy-mm-dd");k.html(t[l])}else{var d="";W.each(t,function(e,o){d+=o}),k.html(d)}if(e.has_slots){L?B.find(".bookly-label-error").html(L):B.find(".bookly-label-error").hide(),(m=parseInt(W(window).height()/36,10))<4?m=4:10<m&&(m=10),10<(y=parseInt(u.width()/_,10))?y=10:0==y&&(j=!0,y=4),x(),v||1!=f.length||i.hide();var c=W(".bookly-time-step",B).hammer({swipe_velocity:.1});c.on("swipeleft",function(){i.is(":visible")&&i.trigger("click")}),c.on("swiperight",function(){a.is(":visible")&&a.trigger("click")}),i.on("click",function(e){if(a.show(),f.eq(r+1).length)k.animate({left:(n?"+":"-")+(r+1)*p.width()},{duration:800}),p=f.eq(++r),u.animate({height:p.height()},{duration:800}),r+1!=f.length||v||i.hide();else if(v){var o=W("> button:last",k);0==o.length&&0==(o=W(".bookly-column:hidden:last > button:last",k)).length&&(o=W(".bookly-column:last > button:last",k));var t={action:"bookly_render_next_time",csrf_token:BooklyL10n.csrf_token,form_id:C.form_id,last_slot:o.val()},s=V(this);W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:t,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){if(e.success)if(e.has_slots){v=e.has_more_slots;var t="";W.each(T(e.slots_data,e.selected_date),function(e,o){t+=o});var o=W(t),a=o.eq(0);W('button.bookly-day[value="'+a.attr("value")+'"]',B).length&&(o=o.not(":first")),k.append(o),x(),i.trigger("click")}else i.hide();else i.hide();s.stop()}})}}),a.on("click",function(){i.show(),p=f.eq(--r),k.animate({left:(n?"+":"-")+r*p.width()},{duration:800}),u.animate({height:p.height()},{duration:800}),0===r&&a.hide()})}void 0===C&&ee(B)}else S({form_id:C.form_id});function w(){W(".bookly-time-screen,.bookly-not-time-screen",B).addClass("bookly-spin-overlay");var e={lines:11,length:11,width:4,radius:5};f?new Spinner(e).spin(f.eq(r).get(0)):new Spinner(e).spin(W(".bookly-not-time-screen",B).get(0))}function x(){var e,o,t,a=W("> button",k),s=0,i=0;if(g)for(;0<a.length;)a.eq(0).hasClass("bookly-day")?(s=1,o=W('<div class="'+h+'" />'),(e=W(a.splice(0,1))).addClass("bookly-js-first-child"),o.append(e)):(s++,e=W(a.splice(0,1)),!a.length||a.eq(0).hasClass("bookly-day")?(e.addClass("bookly-last-child"),o.append(e),k.append(o)):o.append(e)),i<s&&(i=s);else for(;v?a.length>m:a.length;){o=W('<div class="'+h+'" />'),i=m,b%y!=0||a.eq(0).hasClass("bookly-day")||--i;for(var r=0;r<i&&(r+1!=i||!a.eq(0).hasClass("bookly-day"));++r)e=W(a.splice(0,1)),0==r?e.addClass("bookly-js-first-child"):r+1==i&&e.addClass("bookly-last-child"),o.append(e);k.append(o),++b}for(var n=W("> .bookly-column",k);v?n.length>=y:n.length;){t=W('<div class="bookly-time-screen"/>');for(r=0;r<y;++r){if(o=W(n.splice(0,1)),0==r){o.addClass("bookly-js-first-column");var l=o.find(".bookly-js-first-child");if(!l.hasClass("bookly-day")){var d=l.data("group"),c=W('button.bookly-day[value="'+d+'"]:last',B);o.prepend(c.clone())}}t.append(o)}k.append(t)}f=W(".bookly-time-screen",k),null===p&&(p=f.eq(0)),W("button.bookly-hour",B).off("click").on("click",function(e){e.preventDefault();var o=W(this),t={action:"bookly_session_save",csrf_token:BooklyL10n.csrf_token,form_id:C.form_id,slots:this.value};o.attr({"data-style":"zoom-in","data-spinner-color":"#333","data-spinner-size":"40"}),V(this),W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:t,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){G[C.form_id].skip_steps.repeat?G[C.form_id].skip_steps.cart?D({form_id:C.form_id,add_to_cart:!0}):ae({form_id:C.form_id,add_to_cart:!0,from_step:"time"}):se({form_id:C.form_id})}})}),W(".bookly-time-step",B).width(y*_),u.height(j?39*W(".bookly-column.bookly-js-first-column button",p).length:p.height()),j=!1}}})}function P(c){var e={action:"bookly_render_extras",csrf_token:BooklyL10n.csrf_token},f=G[c.form_id].$container;G[c.form_id].skip_steps.service&&G[c.form_id].use_client_time_zone&&(e.time_zone=G[c.form_id].timeZone,e.time_zone_offset=G[c.form_id].timeZoneOffset),W.extend(e,c),W.ajax({url:BooklyL10n.ajaxurl,data:e,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){if(e.success){BooklyL10n.csrf_token=e.csrf_token,f.html(e.html),void 0===c&&ee(f);var s,i,o=W(".bookly-js-next-step",f),t=W(".bookly-js-back-step",f),a=W(".bookly-js-go-to-cart",f),r=W(".bookly-js-extras-item",f),n=W(".bookly-js-extras-summary span",f),l=e.currency,d=function(e,o){var t=e.find("input"),a=e.find(".bookly-js-extras-total-price"),s=o*parseFloat(e.data("price"));a.text(l.format.replace("1",s.toFixed(l.precision))),t.val(o),e.find(".bookly-js-extras-thumb").toggleClass("bookly-extras-selected",0<o);var i=0;r.each(function(e,o){var t=W(this);i+=parseFloat(t.data("price"))*t.find("input").val()}),i?n.html(" + "+l.format.replace("1",i.toFixed(l.precision))):n.html("")};r.each(function(e,o){var t=W(this),a=t.find("input");t.find(".bookly-js-extras-thumb").on("click",function(){d(t,0<a.val()?0:1)}),t.find(".bookly-js-count-control").on("click",function(){var e=parseInt(a.val());e=W(this).hasClass("bookly-js-extras-increment")?Math.min(t.data("max_quantity"),e+1):Math.max(0,e-1),d(t,e)})}),a.on("click",function(e){e.preventDefault(),V(this),ae({form_id:c.form_id,from_step:"extras"})}),o.on("click",function(e){e.preventDefault(),V(this);var a={};W(".bookly-js-extras-container",f).each(function(){var e=W(this),o=e.data("chain"),t={};e.find(".bookly-js-extras-item").each(function(e,o){s=W(this),0<(i=s.find("input")).val()&&(t[s.data("id")]=i.val())}),a[o]=JSON.stringify(t)}),W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:{action:"bookly_session_save",csrf_token:BooklyL10n.csrf_token,form_id:c.form_id,extras:a},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){ie({form_id:c.form_id})}})}),t.on("click",function(e){e.preventDefault(),V(this),S({form_id:c.form_id})}).toggle(!G[c.form_id].skip_steps.service)}}})}function S(q){if(G[q.form_id].skip_steps.service)G[q.form_id].skip_steps.extras?ie(q):P(q);else{var e={action:"bookly_render_service",csrf_token:BooklyL10n.csrf_token},F=G[q.form_id].$container;G[q.form_id].use_client_time_zone&&(e.time_zone=G[q.form_id].timeZone,e.time_zone_offset=G[q.form_id].timeZoneOffset),W.extend(e,q),W.ajax({url:BooklyL10n.ajaxurl,data:e,dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){if(e.success){BooklyL10n.csrf_token=e.csrf_token,F.html(e.html),void 0===q&&ee(F);var a=W(".bookly-js-chain-item.bookly-js-draft",F),o=W(".bookly-js-select-location",F),t=W(".bookly-js-select-category",F),s=W(".bookly-js-select-service",F),i=W(".bookly-js-select-employee",F),r=W(".bookly-js-select-units-duration",F),n=W(".bookly-js-select-number-of-persons",F),l=W(".bookly-js-select-quantity",F),d=W(".bookly-js-date-from",F),c=W(".bookly-js-week-day",F),f=W(".bookly-js-select-time-from",F),m=W(".bookly-js-select-time-to",F),y=W(".bookly-js-next-step",F),u=W(".bookly-js-mobile-next-step",F),k=W(".bookly-js-mobile-prev-step",F),h=e.locations,b=e.categories,v=e.services,j=e.staff,p=e.chain,_=e.required,g=e.defaults,w=e.services_per_location,x=0,C=!1,L=e.service_name_with_duration,B=e.show_ratings;d.pickadate({formatSubmit:"yyyy-mm-dd",format:G[q.form_id].date_format,min:e.date_min||!0,max:e.date_max||!0,clear:!1,close:!1,today:BooklyL10n.today,monthsFull:BooklyL10n.months,weekdaysFull:BooklyL10n.days,weekdaysShort:BooklyL10n.daysShort,labelMonthNext:BooklyL10n.nextMonth,labelMonthPrev:BooklyL10n.prevMonth,firstDay:G[q.form_id].start_of_week,onSet:function(e){if(W.isNumeric(e.select)){var o=new Date(e.select);W('.bookly-js-week-day[value="'+(o.getDay()+1)+'"]:not(:checked)',F).attr("checked",!0).trigger("change")}}}),W(".bookly-js-go-to-cart",F).on("click",function(e){e.preventDefault(),V(this),ae({form_id:q.form_id,from_step:"service"})});var T=function(e,o,t){W('option:not([value=""])',e).remove();var a,s=document.createDocumentFragment();o=(a=o,Object.keys(a).map(function(e){return a[e]})).sort(function(e,o){return parseInt(e.pos)<parseInt(o.pos)?-1:parseInt(e.pos)>parseInt(o.pos)?1:0}),W.each(o,function(e,o){var t=document.createElement("option");t.value=o.id,t.text=o.name,s.appendChild(t)}),e.append(s),e.find('option[value="'+t+'"]').length&&e.val(t)},D=function(e,a,s,i,t){var r=w&&a?a:0,n={},l={},d={},o={},c=null,f=null;if(W.each(j,function(o,t){a&&!h[a].staff.hasOwnProperty(o)||(i?t.services.hasOwnProperty(i)&&t.services[i].locations.hasOwnProperty(r)&&(f=f?Math.min(f,t.services[i].locations[r].min_capacity):t.services[i].locations[r].min_capacity,c=c?Math.max(c,t.services[i].locations[r].max_capacity):t.services[i].locations[r].max_capacity,null!=t.services[i].locations[r].price?n[o]={id:o,name:t.name+" ("+t.services[i].locations[r].price+")",pos:t.pos}:n[o]={id:o,name:t.name,pos:t.pos}):s?W.each(t.services,function(e){if(v[e].category_id==s)return n[o]=W.extend({},t),!1}):n[o]=W.extend({},t))}),a){var m=[],y=[];W.each(n,function(o){W.each(j[o].services,function(e){j[o].services[e].locations.hasOwnProperty(r)&&(m.push(v[e].category_id),y.push(e))})}),W.each(b,function(e,o){-1<W.inArray(parseInt(e),m)&&(d[e]=o)}),W.each(v,function(e,o){-1<W.inArray(e,y)&&(s&&o.category_id!=s||t&&!j[t].services.hasOwnProperty(e)||(l[e]=o))})}else d=b,W.each(v,function(e,o){s&&o.category_id!=s||t&&!j[t].services.hasOwnProperty(e)||(l[e]=o)});for(var u=W(".bookly-js-select-number-of-persons",e).val()||1,k=i?t?j[t].services[i].locations.hasOwnProperty(r)?j[t].services[i].locations[r].max_capacity:1:c||1:1,p=i?t?j[t].services[i].locations.hasOwnProperty(r)?j[t].services[i].locations[r].min_capacity:1:f||1:1,_=p;_<=k;++_)o[_]={id:_,name:_,pos:_};k<u&&(u=k),(u<p||!G[q.form_id].form_attributes.show_number_of_persons)&&(u=p),B&&W.each(j,function(e,o){n.hasOwnProperty(o.id)&&(i?o.services.hasOwnProperty(i)&&o.services[i].rating&&(n[o.id].name="★"+o.services[i].rating+" "+n[o.id].name):o.rating&&(n[o.id].name="★"+o.rating+" "+n[o.id].name))}),T(e.find(".bookly-js-select-category"),d,s),T(e.find(".bookly-js-select-service"),l,i),T(e.find(".bookly-js-select-employee"),n,t),T(e.find(".bookly-js-select-number-of-persons"),o,u)};F.off("click").off("change"),F.on("change",".bookly-js-select-location",function(){var e=W(this).closest(".bookly-js-chain-item"),o=this.value,t=e.find(".bookly-js-select-category").val(),a=e.find(".bookly-js-select-service").val(),s=e.find(".bookly-js-select-employee").val();if(o){var i=w?o:0;if(s&&(h[o].staff.hasOwnProperty(s)?a&&!j[s].services[a].locations.hasOwnProperty(i)&&(s=""):s=""),a){var r=!1;W.each(h[o].staff,function(e){if(j[e].services.hasOwnProperty(a))return!(r=!0)}),r||(a="")}if(t){r=!1;W.each(h[o].staff,function(e){if(W.each(j[e].services,function(e){if(v[e].category_id==t)return!(r=!0)}),r)return!1}),r||(t="")}}D(e,o,t,a,s)}),F.on("change",".bookly-js-select-category",function(){var e=W(this).closest(".bookly-js-chain-item"),o=e.find(".bookly-js-select-location").val(),t=this.value,a=e.find(".bookly-js-select-service").val(),s=e.find(".bookly-js-select-employee").val();if(t){if(C=!0,a&&v[a].category_id!=t&&(a=""),s){var i=!1;W.each(j[s].services,function(e){if(v[e].category_id==t)return!(i=!0)}),i||(s="")}}else C=!1;D(e,o,t,a,s)});var S=function(e,a,o,s){var t=e.find(".bookly-js-select-units-duration");if(t.find("option").remove(),a){W.each(function(e){if(!e)return v[a].units;var o=s||0,t=j[e].services[a].locations;return t instanceof Array&&t.length&&(-1!==t.indexOf(o)?t[o]:t[0]).units||[]}(o),function(e,o){t.append(W("<option>",{value:o.value,text:o.title}))})}else t.append(W("<option>",{value:"",text:"-"}))};if(F.on("change",".bookly-js-select-service",function(){var e=W(this).closest(".bookly-js-chain-item"),o=e.find(".bookly-js-select-location").val(),t=C?e.find(".bookly-js-select-category").val():"",a=this.value,s=e.find(".bookly-js-select-employee").val();a&&s&&!j[s].services.hasOwnProperty(a)&&(s=""),D(e,o,t,a,s),a&&e.find(".bookly-js-select-category").val(v[a].category_id),S(e,a,s,o)}),F.on("change",".bookly-js-select-employee",function(){var e=W(this).closest(".bookly-js-chain-item"),o=e.find(".bookly-js-select-location").val(),t=W(".bookly-js-select-category",e).val(),a=e.find(".bookly-js-select-service").val(),s=this.value;D(e,o,t,a,s),S(e,a,s,o)}),L&&W.each(v,function(e,o){o.name=o.name+" ( "+o.duration+" )"}),T(o,h),T(t,b),T(s,v),B){var O={};W.each(j,function(e,o){O[e]=W.extend({},o),o.rating&&(O[e].name="★"+o.rating+" "+O[e].name)}),T(i,O)}else T(i,j);o.closest(".bookly-form-group").toggle(!G[q.form_id].form_attributes.hide_locations),t.closest(".bookly-form-group").toggle(!G[q.form_id].form_attributes.hide_categories),s.closest(".bookly-form-group").toggle(!(G[q.form_id].form_attributes.hide_services&&g.service_id)),i.closest(".bookly-form-group").toggle(!G[q.form_id].form_attributes.hide_staff_members),r.closest(".bookly-form-group").toggle(!G[q.form_id].form_attributes.hide_service_duration),n.closest(".bookly-form-group").toggle(G[q.form_id].form_attributes.show_number_of_persons),l.closest(".bookly-form-group").toggle(!G[q.form_id].form_attributes.hide_quantity),g.location_id&&o.val(g.location_id).trigger("change"),g.category_id&&t.val(g.category_id).trigger("change"),g.service_id&&s.val(g.service_id).trigger("change"),g.staff_id&&i.val(g.staff_id).trigger("change"),G[q.form_id].form_attributes.hide_date&&W(".bookly-js-available-date",F).hide(),G[q.form_id].form_attributes.hide_week_days&&W(".bookly-js-week-days",F).hide(),G[q.form_id].form_attributes.hide_time_range&&W(".bookly-js-time-range",F).hide(),W.each(p,function(e,o){var t=a.clone().data("chain_key",e).removeClass("bookly-js-draft").css("display","table");a.find("select").each(function(e,o){t.find("select:eq("+e+")").val(o.value)}),0==(x=e)&&t.find('.bookly-js-actions button[data-action="drop"]').remove(),W(".bookly-js-chain-item:last",F).after(t),!G[q.form_id].form_attributes.hide_locations&&o.location_id&&W(".bookly-js-select-location",t).val(o.location_id).trigger("change"),o.service_id&&(W(".bookly-js-select-service",t).val(o.service_id).trigger("change"),G[q.form_id].form_attributes.hide_categories&&W(".bookly-js-select-category",t).val("")),!G[q.form_id].form_attributes.hide_staff_members&&1==o.staff_ids.length&&o.staff_ids[0]&&W(".bookly-js-select-employee",t).val(o.staff_ids[0]).trigger("change"),1<o.number_of_persons&&W(".bookly-js-select-number-of-persons",t).val(o.number_of_persons),1<o.units&&W(".bookly-js-select-units-duration",t).val(o.units),1<o.quantity&&W(".bookly-js-select-quantity",t).val(o.quantity)}),F.on("click",".bookly-js-mobile-step-1 .bookly-js-actions button",function(){switch(W(this).data("action")){case"plus":var t=a.clone();a.find("select").each(function(e,o){t.find("select:eq("+e+")").val(o.value)}),W(".bookly-js-chain-item:last",F).after(t.data("chain_key",++x).removeClass("bookly-js-draft").css("display","table"));break;case"drop":W(this).closest(".bookly-js-chain-item").remove()}}),c.on("change",function(){var e=W(this);e.is(":checked")?e.parent().not("[class*='active']").addClass("active"):e.parent().removeClass("active")}),f.on("change",function(){var e=W(this).val(),o=m.val(),t=W("option:last",f);m.empty(),f[0].selectedIndex<t.index()?W("option",this).each(function(){W(this).val()>e&&m.append(W(this).clone())}):m.append(t.clone()).val(t.val());var a=W("option:first",m).val();m.val(a<=o?o:a)});var M=function(){W(".bookly-js-select-service-error",F).hide(),W(".bookly-js-select-employee-error",F).hide(),W(".bookly-js-select-location-error",F).hide();var o=!0,t=null,a=null,s=null,i=null;return W(".bookly-js-chain-item:not(.bookly-js-draft)",F).each(function(){var e=W(this);t=W(".bookly-js-select-service",e),a=W(".bookly-js-select-employee",e),s=W(".bookly-js-select-location",e),t.removeClass("bookly-error"),a.removeClass("bookly-error"),s.removeClass("bookly-error"),t.val()||(o=!1,t.addClass("bookly-error"),W(".bookly-js-select-service-error",e).show(),i=t),_.hasOwnProperty("location")&&_.location&&!s.val()&&(o=!1,s.addClass("bookly-error"),W(".bookly-js-select-location-error",e).show(),i=s),_.staff&&!a.val()&&(o=!1,a.addClass("bookly-error"),W(".bookly-js-select-employee-error",e).show(),i=a)}),d.removeClass("bookly-error"),d.val()||(o=!1,d.addClass("bookly-error"),null===i&&(i=d)),W(".bookly-js-week-day:checked",F).length||(o=!1,null===i&&(i=c)),null!==i&&ee(i),o};y.on("click",function(e){if(e.preventDefault(),M()){V(this);var t={},a=0;W(".bookly-js-chain-item:not(.bookly-js-draft)",F).each(function(){var e=W(this),o=[];W(".bookly-js-select-employee",e).val()?o.push(W(".bookly-js-select-employee",e).val()):W(".bookly-js-select-employee",e).find("option").each(function(){this.value&&o.push(this.value)}),t[e.data("chain_key")]={location_id:W(".bookly-js-select-location",e).val(),service_id:W(".bookly-js-select-service",e).val(),staff_ids:o,units:W(".bookly-js-select-units-duration",e).val()||1,number_of_persons:W(".bookly-js-select-number-of-persons",e).val()||1,quantity:W(".bookly-js-select-quantity",e).val()?W(".bookly-js-select-quantity",e).val():1},a+=v[W(".bookly-js-select-service",e).val()].has_extras});var o=[];W(".bookly-js-week-days .active input.bookly-js-week-day",F).each(function(){o.push(this.value)}),W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:{action:"bookly_session_save",csrf_token:BooklyL10n.csrf_token,form_id:q.form_id,chain:t,date_from:d.pickadate("picker").get("select","yyyy-mm-dd"),days:o,time_from:f.val(),time_to:m.val(),no_extras:0==a},dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){G[q.form_id].skip_steps.extras?ie({form_id:q.form_id}):0==a?(G[q.form_id].no_extras=!0,ie({form_id:q.form_id})):(G[q.form_id].no_extras=!1,P({form_id:q.form_id}))}})}}),u.on("click",function(e,o){return M()&&(G[q.form_id].skip_steps.service_part2?(V(this),y.trigger("click")):(W(".bookly-js-mobile-step-1",F).hide(),W(".bookly-js-mobile-step-2",F).css("display","block"),1!=o&&ee(F))),!1}),G[q.form_id].skip_steps.service_part1?(u.trigger("click",[!0]),k.remove()):k.on("click",function(){return W(".bookly-js-mobile-step-1",F).show(),W(".bookly-js-mobile-step-2",F).hide(),s.val()&&W(".bookly-js-select-service",F).parent().removeClass("bookly-error"),!1})}}})}}window.bookly=function(e){var o;(G[e.form_id]=e,G[e.form_id].$container=W("#bookly-form-"+e.form_id),G[e.form_id].timeZone="object"==typeof Intl?Intl.DateTimeFormat().resolvedOptions().timeZone:void 0,G[e.form_id].timeZoneOffset=(new Date).getTimezoneOffset(),G[e.form_id].skip_steps.service=e.skip_steps.service_part1&&e.skip_steps.service_part2,"finished"==e.status.booking?oe({form_id:e.form_id}):"cancelled"==e.status.booking?te({form_id:e.form_id}):S({form_id:e.form_id,new_chain:!0}),e.hasOwnProperty("facebook")&&e.facebook.enabled&&(o=e,FB.init({appId:o.facebook.appId,status:!0,version:"v2.12"}),FB.getLoginStatus(function(e){"connected"===e.status?(o.facebook.enabled=!1,FB.api("/me",{fields:"id,name,first_name,last_name,email,link"},function(e){W.ajax({type:"POST",url:BooklyL10n.ajaxurl,data:W.extend(e,{action:"bookly_pro_facebook_login",csrf_token:BooklyL10n.csrf_token,form_id:o.form_id}),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:"withCredentials"in new XMLHttpRequest,success:function(e){}})})):FB.Event.subscribe("auth.statusChange",function(e){o.facebook.onStatusChange&&o.facebook.onStatusChange(e)})})),e.hasOwnProperty("google_maps")&&e.google_maps.enabled)&&function(e,o,t){var a=document.createElement("script");a.type="text/javascript",void 0!==o&&(a.async=o);t instanceof Function&&(a.onload=t);document.head.appendChild(a),a.src=e}("https://maps.googleapis.com/maps/api/js?key="+e.google_maps.api_key+"&libraries=places",!0)}}(jQuery);
//# sourceMappingURL=bookly.min.js.map